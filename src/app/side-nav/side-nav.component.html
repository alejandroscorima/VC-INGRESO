<input type="file" id="profile-photo-input" accept="image/jpeg,image/png,image/gif" (change)="onProfilePhotoChange($event)" class="hidden" />

<!-- Posición y altura se fuerzan en side-nav.component.css (#logo-sidebar) para que quede debajo del navbar -->
<aside id="logo-sidebar" class="sidebar-aside fixed left-0 z-30 flex w-64 flex-col -translate-x-full border-r border-gray-200 bg-white pt-6 transition-transform dark:border-gray-700 dark:bg-gray-800 sm:translate-x-0"
  aria-label="Sidebar" tabindex="-1">
  <div class="flex min-h-0 flex-1 flex-col px-3 pb-4">

    <!-- Usuario (arriba del sidebar, sobre las pestañas) -->
    <div class="shrink-0 pb-4">
      <div class="flex items-center gap-3 rounded-lg bg-gray-50 p-3 dark:bg-gray-700/50">
        <button type="button" (click)="onProfilePhotoClick()" [disabled]="uploadingPhoto"
          class="relative shrink-0 rounded-full focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
          title="Cambiar foto de perfil">
          <img class="h-10 w-10 rounded-full object-cover shadow" [src]="getUserAvatarUrl(user)" alt="Usuario" />
          <span *ngIf="uploadingPhoto" class="absolute inset-0 flex items-center justify-center rounded-full bg-black/50 text-white text-xs">...</span>
        </button>
        <div class="min-w-0 flex-1">
          <p class="truncate text-sm font-medium text-gray-900 dark:text-white">{{ getUserDisplayName(user) }}</p>
          <p class="truncate text-xs text-gray-500 dark:text-gray-400">{{ user?.role_system ?? '—' }}</p>
          <p class="truncate text-xs text-gray-500 dark:text-gray-400">{{ getUserDomicilio(user) }}</p>
        </div>
      </div>
    </div>

    <!-- Navegación: scroll solo aquí -->
    <nav class="min-h-0 flex-1 space-y-1 overflow-y-auto">
      <p class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-gray-400 dark:text-gray-500">Principal</p>
      <ul class="space-y-0.5">
        <li>
          <a routerLink="/" routerLinkActive="nav-item-active" [routerLinkActiveOptions]="{ exact: true }"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">dashboard</mat-icon>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a routerLink="/history" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">history</mat-icon>
            <span>Historial</span>
          </a>
        </li>
        <li>
          <a routerLink="/hb" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">cake</mat-icon>
            <span>Cumpleaños</span>
          </a>
        </li>
        <li>
          <a routerLink="/my-house" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">home</mat-icon>
            <span>Mi casa</span>
          </a>
        </li>
        <li>
          <a routerLink="/calendar" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">event</mat-icon>
            <span>Calendario</span>
          </a>
        </li>
        <li>
          <a routerLink="/scanner" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">qr_code_scanner</mat-icon>
            <span>Escáner QR</span>
          </a>
        </li>
      </ul>

      <div class="my-4 border-t border-gray-200 dark:border-gray-700"></div>

      <p class="px-3 py-2 text-xs font-semibold uppercase tracking-wider text-gray-400 dark:text-gray-500">Gestión</p>
      <ul class="space-y-0.5" *ngIf="user?.role_system === 'ADMINISTRADOR' || user?.role_system === 'ADMIN'">
        <li>
          <a routerLink="/users" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">person</mat-icon>
            <span>Usuarios</span>
          </a>
        </li>
        <li>
          <a routerLink="/houses" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">apartment</mat-icon>
            <span>Viviendas</span>
          </a>
        </li>
        <li>
          <a routerLink="/vehicles" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">directions_car</mat-icon>
            <span>Vehículos</span>
          </a>
        </li>
        <li>
          <a routerLink="/pets" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">pets</mat-icon>
            <span>Mascotas</span>
          </a>
        </li>
      </ul>

      <div class="my-4 border-t border-gray-200 dark:border-gray-700"></div>

      <ul class="space-y-0.5">
        <li>
          <a routerLink="/settings" routerLinkActive="nav-item-active"
            class="nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 hover:bg-gray-100">
            <mat-icon class="nav-item-icon">settings</mat-icon>
            <span>Configuración</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Pie del sidebar: enlace Crearttech -->
    <div class="shrink-0 border-t border-gray-200 pt-3 dark:border-gray-700">
      <a href="https://api.whatsapp.com/send/?phone=51982160981&text=Requiero+ayuda+con+la+aplicaci%C3%B3n" target="_blank" rel="noopener"
        class="flex items-center justify-center gap-2 rounded-lg px-3 py-2 text-xs font-medium text-amber-600 hover:bg-amber-50 dark:text-amber-400 dark:hover:bg-amber-900/20">
        Crearttech Solutions
      </a>
    </div>
  </div>
</aside>
