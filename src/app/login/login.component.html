<section class="login-section">
  <div class="login-bg"
       style="background-image: url('http://52.5.47.64/VC/Media/Backgrounds/BG-INGRESO-VC5.png')"></div>

  <div class="login-card relative w-full max-w-md">
    <div class="login-form-inner rounded-2xl shadow-2xl overflow-hidden">
      <!-- Cabecera con logo -->
      <div class="login-header px-6 pt-6 pb-1 sm:pt-8 sm:pb-2 text-center">
        <div class="flex items-center justify-center gap-3 mb-0">
          <img class="w-20 h-20 sm:w-12 sm:h-12 object-contain rounded-lg flex-shrink-0"
               [src]="systemClient?.client_logo || 'assets/logo_VC5.png'" alt="Logo">
          <h1 class="text-xl sm:text-2xl font-bold text-gray-900">CONTROL DE ACCESOS</h1>
        </div>
      </div>

      <!-- Formulario -->
      <div class="login-body px-6 pt-2 pb-6 sm:px-8 sm:pt-3 sm:pb-8">
        <p class="text-gray-600 text-sm sm:text-base mb-6">Ingresa tus credenciales para acceder al sistema.</p>

        <form class="space-y-5" (ngSubmit)="login()" #loginForm="ngForm">
          <!-- Usuario -->
          <div>
            <label for="username_system" class="block text-sm font-medium text-gray-700 mb-2">Usuario</label>
            <div class="relative">
              <mat-icon class="login-input-icon">person</mat-icon>
              <input type="text"
                     name="username_system"
                     id="username_system"
                     [(ngModel)]="username_system"
                     required
                     placeholder="Ingresa tu usuario"
                     (keyup.enter)="log.click()"
                     class="login-input pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition bg-gray-50 text-gray-900 placeholder-gray-400">
            </div>
          </div>

          <!-- Contraseña -->
          <div>
            <label for="password_system" class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
            <div class="relative">
              <mat-icon class="login-input-icon">lock</mat-icon>
              <input [type]="hide ? 'password' : 'text'"
                     name="password_system"
                     id="password_system"
                     [(ngModel)]="password_system"
                     required
                     placeholder="Ingresa tu contraseña"
                     (keyup.enter)="log.click()"
                     class="login-input pl-10 pr-12 py-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition bg-gray-50 text-gray-900 placeholder-gray-400">
              <button type="button"
                      (click)="hide = !hide"
                      class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none p-1"
                      [attr.aria-label]="hide ? 'Mostrar contraseña' : 'Ocultar contraseña'">
                <mat-icon class="align-middle">{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
          </div>

          <!-- Recordar usuario + link registro -->
          <div class="flex items-center justify-between flex-wrap gap-2">
            <label class="flex items-center cursor-pointer select-none">
              <input type="checkbox" class="h-4 w-4 text-amber-600 border-gray-300 rounded focus:ring-amber-500">
              <span class="ml-2 text-sm text-gray-600">Recordar usuario</span>
            </label>
            <a routerLink="/registro" class="text-sm text-amber-600 hover:text-amber-700 hover:underline">¿Nuevo propietario? Regístrese aquí</a>
          </div>

          <!-- Botón iniciar sesión -->
          <button type="submit"
                  [disabled]="isloading"
                  #log
                  class="login-btn w-full font-semibold py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2">
            <mat-icon>login</mat-icon>
            <span>{{ isloading ? 'Cargando...' : 'Iniciar Sesión' }}</span>
          </button>
        </form>

        <!-- Versión y copyright -->
        <div class="mt-8 pt-6 border-t border-gray-200 text-center">
          <p class="text-sm text-gray-500">Versión 1.0</p>
          <p class="text-xs text-gray-400 mt-1">© Crearttech Solutions S.A.C.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal: cambiar contraseña temporal (primer acceso) -->
<div *ngIf="showChangePasswordModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Cambiar contraseña temporal</h3>
    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Debe definir una nueva contraseña para continuar.</p>
    <div class="space-y-3">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nueva contraseña</label>
        <input type="password" [(ngModel)]="newPassword" class="w-full rounded border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white p-2" placeholder="Mínimo 6 caracteres" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Confirmar contraseña</label>
        <input type="password" [(ngModel)]="confirmPassword" class="w-full rounded border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white p-2" placeholder="Repita la contraseña" />
      </div>
    </div>
    <div class="flex gap-2 mt-6">
      <button type="button" (click)="submitChangePassword()" [disabled]="changingPassword" class="flex-1 !bg-amber-600 !text-white rounded-lg py-2 px-4 hover:!bg-amber-700 disabled:opacity-50 font-medium">
        {{ changingPassword ? 'Guardando...' : 'Guardar' }}
      </button>
      <button type="button" (click)="cancelChangePassword()" [disabled]="changingPassword" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Cancelar</button>
    </div>
  </div>
</div>
